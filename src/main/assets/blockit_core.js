(function(){"use strict";var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};function __extends(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};function __awaiter(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}function __generator(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}function __values(o){var s=typeof Symbol==="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}var _global=function(){return this||(0,eval)("this")}();var apiSyncListEnum=["canIUse","getLogManager","createCanvasContext","canvasGetImageData","canvasPutImageData"];var apiAsyncListEnum=["getHostInfo","getUserInfo","onViewResize","offViewResize","hideBlockLoading","onThemeChange","offThemeChange"];var apiListEnum=apiSyncListEnum.concat(apiAsyncListEnum);var blockApiSyncListEnum=[];var blockApiAsyncListEnum=["saveState"];var blockApiListEnum=blockApiSyncListEnum.concat(blockApiAsyncListEnum);var creatorApiSyncListEnum=[];var creatorApiAsyncListEnum=["setBlockInfo","cancel"];var creatorApiListEnum=creatorApiSyncListEnum.concat(creatorApiAsyncListEnum);var commonParams={success:{required:false,type:["Function"]},fail:{required:false,type:["Function"]},complete:{required:false,type:["Function"]}};var setBlockInfo=__assign({},commonParams);var cancel=__assign({},commonParams);var saveState=__assign({},commonParams);var getHostInfo=__assign({},commonParams);var getUserInfo=__assign({},commonParams);var onViewResize=__assign({},commonParams);var offViewResize=__assign({},commonParams);var hideBlockLoading=__assign({},commonParams);var onThemeChange=__assign({},commonParams);var offThemeChange=__assign({},commonParams);var canIUse={};var getLogManager={};var createCanvasContext={};var canvasGetImageData=__assign({},commonParams);var canvasPutImageData=__assign({},commonParams);var apiParams=Object.freeze({__proto__:null,setBlockInfo:setBlockInfo,cancel:cancel,saveState:saveState,getHostInfo:getHostInfo,getUserInfo:getUserInfo,onViewResize:onViewResize,offViewResize:offViewResize,hideBlockLoading:hideBlockLoading,onThemeChange:onThemeChange,offThemeChange:offThemeChange,canIUse:canIUse,getLogManager:getLogManager,createCanvasContext:createCanvasContext,canvasGetImageData:canvasGetImageData,canvasPutImageData:canvasPutImageData});function isObject(val){return Object.prototype.toString.call(val).slice(8,-1)==="Object"}function hasProperty(object,property){return Object.prototype.hasOwnProperty.call(object||{},property)}function getDataType(data){return Object.prototype.toString.call(data).split(" ")[1].slice(0,-1)}var ThirdScriptError=function(_super){__extends(ThirdScriptError,_super);function ThirdScriptError(msg){var _this=_super.call(this,""+msg)||this;_this.type="ThirdScriptError";return _this}return ThirdScriptError}(Error);var AppServiceSdkKnownError=function(_super){__extends(AppServiceSdkKnownError,_super);function AppServiceSdkKnownError(msg){var _this=_super.call(this,"APP-SERVICE-SDK: + "+msg)||this;_this.type="AppServiceSdkKnownError";return _this}return AppServiceSdkKnownError}(Error);var ErrorCode;(function(ErrorCode){ErrorCode[ErrorCode["SUCCESS"]=0]="SUCCESS";ErrorCode[ErrorCode["UNKNOWN"]=1]="UNKNOWN";ErrorCode[ErrorCode["NODE_NOT_FOUND"]=2]="NODE_NOT_FOUND";ErrorCode[ErrorCode["METHOD_NOT_FOUND"]=3]="METHOD_NOT_FOUND";ErrorCode[ErrorCode["PARAM_INVALID"]=4]="PARAM_INVALID";ErrorCode[ErrorCode["SELECTOR_NOT_SUPPORTED"]=5]="SELECTOR_NOT_SUPPORTED"})(ErrorCode||(ErrorCode={}));var BLOCKIT_CORE={filename:"blockit_core",slot:undefined};function reportError(error,nativeApp){var _a;var report=(_a=_global===null||_global===void 0?void 0:_global.LynxSDKCore)===null||_a===void 0?void 0:_a.report;try{if(typeof report==="function"){report(error,nativeApp,BLOCKIT_CORE)}else{nativeConsole.error("report is not a function",error.message)}}catch(err){nativeConsole.error("API reportError err:",err)}}function surroundByUserTryCatch(func,appInstance,msg){var _a;if(msg===void 0){msg=""}var reportUser=(_a=_global===null||_global===void 0?void 0:_global.LynxSDKCore)===null||_a===void 0?void 0:_a.reportUser;try{if(typeof reportUser==="function"){return reportUser(msg,appInstance,func,BLOCKIT_CORE)}else{nativeConsole.error("reportUser is not a function",func,msg);return fnApply(func,msg)}}catch(err){nativeConsole.error("API reportUser err:",err)}}function fnApply(func,msg){return function(){var res;try{res=func.apply(func,arguments)}catch(err){nativeConsole.error(msg||""+err.message)}return res}}var BaseError=function(_super){__extends(BaseError,_super);function BaseError(message,stack){var _this=_super.call(this,message)||this;_this.message=message;_this.stack=stack;return _this}return BaseError}(Error);var InternalError=function(_super){__extends(InternalError,_super);function InternalError(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.kind="INTERNAL_ERROR";return _this}return InternalError}(BaseError);var UserError=function(_super){__extends(UserError,_super);function UserError(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.kind="USER_ERROR";return _this}return UserError}(BaseError);var UserValidateError=function(_super){__extends(UserValidateError,_super);function UserValidateError(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.name="USER_VALIDATE_ERROR";return _this}return UserValidateError}(UserError);var UserRuntimeError=function(_super){__extends(UserRuntimeError,_super);function UserRuntimeError(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.name="USER_RUNTIME_ERROR";return _this}return UserRuntimeError}(UserError);var InternalRuntimeError=function(_super){__extends(InternalRuntimeError,_super);function InternalRuntimeError(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.name="INTERNAL_RUNTIME_ERROR";return _this}return InternalRuntimeError}(InternalError);var InvokeError=function(_super){__extends(InvokeError,_super);function InvokeError(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.name="INVOKE_ERROR";return _this}return InvokeError}(InternalError);var AppServiceEngineKnownError=function(_super){__extends(AppServiceEngineKnownError,_super);function AppServiceEngineKnownError(msg){var _this=_super.call(this,"APP-SERVICE-Engine: "+msg)||this;_this.type="AppServiceEngineKnownError";return _this}return AppServiceEngineKnownError}(Error);function beforeApiCall(apiParams,args){var e_1,_a;var apiRes={status:0,message:"ok"};if(isObject(apiParams)&&Object.keys(apiParams).length&&args.length===1){var params=args[0];if(!isObject(params)){apiRes.status=2;apiRes.message="Object should be passed in";return}try{for(var _b=__values(Object.keys(apiParams)),_c=_b.next();!_c.done;_c=_b.next()){var param=_c.value;if(apiParams[param].required){if(!hasProperty(params,param)){apiRes.status=1;apiRes.message="params "+param+" is required";break}}if(hasProperty(params,param)){var type=getDataType(params[param]);var exceptType=apiParams[param].type;if(!exceptType.includes(type)){apiRes.status=2;apiRes.message="params "+param+" is not "+type+" type";break}}else{if(hasProperty(apiParams[param],"default")){params[param]=apiParams[param].default}}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(_c&&!_c.done&&(_a=_b.return))_a.call(_b)}finally{if(e_1)throw e_1.error}}}else if(isArray(apiParams)&&apiParams.length>0){for(var i in apiParams){if(args[i]){var type=getDataType(args[i]);var exceptType=apiParams[i].type;if(!exceptType.includes(type)){apiRes.status=2;apiRes.message="the "+i+"st param should not be "+type+" type, shoud be "+exceptType;break}}}}return apiRes}function afterApiCall(apiName,apiRes,params,appInstance){if(typeof apiRes==="string"){try{apiRes=JSON.parse(apiRes)}catch(e){reportError(new InternalRuntimeError("afterApiCall "+apiName+" JSON.parse error: "+e.message,e.stack),appInstance._nativeApp)}}var errMsg=apiRes.errMsg||apiName+":ok";var status=getStatus(apiName,errMsg);var _a=params||{},success=_a.success,fail=_a.fail,cancel=_a.cancel,complete=_a.complete;switch(status){case"success":success&&surroundByUserTryCatch(success,appInstance,"afterApiCall "+apiName).call(appInstance,apiRes);break;case"fail":fail&&surroundByUserTryCatch(fail,appInstance,"afterApiCall "+apiName).call(appInstance,apiRes);break;case"cancel":cancel&&surroundByUserTryCatch(cancel,appInstance,"afterApiCall "+apiName).call(appInstance,apiRes);break}complete&&surroundByUserTryCatch(complete,appInstance,"afterApiCall "+apiName).call(appInstance,apiRes)}var isArray=Array.isArray||function(e){return getDataType(e)==="Array"};function getStatus(method,errMsg){if(errMsg.startsWith(method+":ok")){return"success"}if(errMsg.startsWith(method+":fail")){return"fail"}if(errMsg.startsWith(method+":cancel")){return"cancel"}throw new InvokeError(method+" response's errMsg("+errMsg+") incorrect")}function setBlockInfo$1(cardProxyObj,params,cb){var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;BDLynxModule.invoke("setBlockInfo",params[0],cb)}function cancel$1(cardProxyObj,params,cb){var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;BDLynxModule.invoke("cancel",params[0],cb)}function saveState$1(cardProxyObj,params,cb){var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;BDLynxModule.invoke("saveState",params[0],cb)}function getHostInfo$1(cardProxyObj,params,cb){var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;BDLynxModule.invoke("getHostInfo",params[0],cb)}function getUserInfo$1(cardProxyObj,params,cb){var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;BDLynxModule.invoke("getUserInfo",params[0],cb)}var ON_VIEW_RESIZE="viewResize";function onViewResize$1(cardProxyObj,params){nativeConsole.log("addListener onViewResize");cardProxyObj.emitter.addListener(ON_VIEW_RESIZE,params[0])}function offViewResize$1(cardProxyObj,params){nativeConsole.log("removeListener onViewResize");cardProxyObj.emitter.removeListener(ON_VIEW_RESIZE,params[0])}function registerViewResizeEvent(cardProxyObj){nativeConsole.log("registerViewResizeEvent");this.getJSModule("GlobalEventEmitter").addListener("onWindowResize",(function(width,height){nativeConsole.log("onViewResize trigger success");cardProxyObj.emitter.trigger(ON_VIEW_RESIZE,{width:width,height:height})}),this)}function hideBlockLoading$1(cardProxyObj,params,cb){var _a;var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;BDLynxModule.invoke("hideBlockLoading",(_a=params[0])!==null&&_a!==void 0?_a:{},cb)}var ON_THEME_CHANGE="themeChange";function onThemeChange$1(cardProxyObj,params){nativeConsole.log("addListener onThemeChange");cardProxyObj.emitter.addListener(ON_THEME_CHANGE,params[0])}function offThemeChange$1(cardProxyObj,params){nativeConsole.log("removeListener offThemeChange");cardProxyObj.emitter.removeListener(ON_THEME_CHANGE,params[0])}function registerThemeChangeEvent(BDLynxAPIModule,cardProxyObj){nativeConsole.log("registerThemeChangeEvent");BDLynxAPIModule.addListener("onThemeChange",(function(res){nativeConsole.log("trigger api: onThemeChange");cardProxyObj.emitter.trigger(ON_THEME_CHANGE,res)}))}var hostUnimplemented={workplace:["enterProfile","onContainerResize","offContainerResize"]};var modelUnimplemented={block:["cancel","setBlockInfo"],creator:["saveState"]};var apiConfig={login:[{success:["code"]}],getUserInfo:[{object:["withCredentials"]},{success:[{userInfo:["nickName","i18nName","avatarUrl","gender","country","province","city"]},"rawData","signature","encryptedData","iv"]}],enterProfile:[{object:["openid","left","top"]}],getSystemInfo:[{success:["platform","devicePixelRatio","language","SDKVersion","blockitVersion",{theme:["dark","light"]}]}],getSystemInfoSync:[{return:["platform","devicePixelRatio","language","SDKVersion","blockitVersion",{theme:["dark","light"]}]}],getContainerRect:[{success:["width","height"]}],onContainerResize:[{callback:["width","height"]}],offContainerResize:[{callback:["width","height"]}],onThemeChange:[{callback:[{theme:["dark","light"]}]}],offThemeChange:[{callback:[{theme:["dark","light"]}]}],showToast:[{object:["title",{icon:["success","info","error","warning"]},"duration"]}],showModal:[{object:["title","content","showCancel","cancelText","confirmText"]},{success:["confirm","cancel"]}],hideBlockLoading:[],getStorage:[{object:["key"]},{success:["data"]}],setStorage:[{object:["key","data"]}],removeStorage:[{object:["key"]}],clearStorage:[],getStorageInfo:[{success:["keys","currentSize","limitSize"]}],saveState:[{success:["state"]}],openSchema:[{object:["schema"]}],setBlockInfo:[],cancel:[],request:[{object:["url","header",{method:["GET","POST","PUT"]},"data","dataType","responseType"]},{success:["statusCode","header","data"]},{return:["abort"]}],onMenuItemTap:[{callback:["key","iconUrl","name"]}],offMenuItemTap:[{callback:["key","iconUrl","name"]}],updateMenuItem:[{object:["key","iconUrl","name"]}],removeMenuItem:[{object:["key"]}],addMenuItem:[{object:["key","iconUrl","name"]}],createSelectorQuery:[{return:["in",{select:[{return:[{boundingClientRect:[{callback:["id","dataset","left","right","top","bottom","width","height"]}]}]}]},"exec"]}],getLogManager:[{return:["info","debug","warn","log"]}],createCanvasContext:[{return:["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath",{createCircularGradient:[{return:["addColorStop"]}]},{createLinearGradient:[{return:["addColorStop"]}]},"createPattern","draw","drawImage","fill","fillRect","fillText","fillStyle","globalAlpha","globalCompositeOperation","lineCap","lineDashOffset","lineJoin","lineTo","lineWidth","measureText","miterLimit","moveTo","quadraticCurveTo","rect","restore","rotate","save","scale","setFillStyle","setFontSize","setGlobalAlpha","setLineCap","setLineDash","setLineJoin","setLineWidth","setMiterLimit","setShadow","setStrokeStyle","setTextAlign","setTextBaseline","setTransform","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","stroke","strokeRect","strokeStyle","strokeText","textAlign","textBaseline","transform","translate"]}],canvasPutImageData:[{object:["canvasId","data","x","y","width","height"]}],canvasGetImageData:[{object:["canvasId","x","y","width","height"]},{success:["width","height","data"]}]};function hostSupport(host,api){var _a;var hostInfo=(_a=hostUnimplemented[host])!==null&&_a!==void 0?_a:false;if(!hostInfo){return true}return!hostInfo.includes(api)}function modelSupport(type,api){return!modelUnimplemented[type].includes(api)}function getKeyProps(configs,key){var e_1,_a;try{for(var configs_1=__values(configs),configs_1_1=configs_1.next();!configs_1_1.done;configs_1_1=configs_1.next()){var item=configs_1_1.value;if(typeof item==="string"&&item===key){return[]}if(typeof item==="object"&&item!==null&&item.hasOwnProperty(key)){return item[key]}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(configs_1_1&&!configs_1_1.done&&(_a=configs_1.return))_a.call(configs_1)}finally{if(e_1)throw e_1.error}}return false}function checkAPI(configs,params){if(!params.length){return true}var param=params.shift();var config=getKeyProps(configs,param);return Boolean(config)&&checkAPI(config,params)}function canIUse$1(cardProxyObj,_a){var _b;var _c=__read(_a,1),_d=_c[0],schema=_d===void 0?"":_d;if(typeof schema!=="string"){throw new Error("canIUse: schema should be string")}var host="workplace";var blockType=(_b=_global.__blockType)!==null&&_b!==void 0?_b:"block";var _e=__read(schema.split(".")),api=_e[0],rest=_e.slice(1);return modelSupport(blockType,api)&&hostSupport(host,api)&&Boolean(apiConfig[api])&&checkAPI(apiConfig[api],rest)}var LogLevel;(function(LogLevel){LogLevel["INFO"]="info";LogLevel["DEBUG"]="debug";LogLevel["LOG"]="log";LogLevel["WARN"]="warn"})(LogLevel||(LogLevel={}));var logManagerStore=new Map;var MAX_SIZE=100;var getMinuteStamp=function(timeStamp){return Math.floor(timeStamp/1e3/60)};function checkFreq(time,cardProxyObj){var key=getMinuteStamp(time.getTime());if(key!==cardProxyObj.prevKey){cardProxyObj.prevKey=key;cardProxyObj.cnt=0}return++cardProxyObj.cnt<=MAX_SIZE}var defaultSize=100*1024;function checkSize(str){return str.length<=defaultSize}var logLevels=[LogLevel.INFO,LogLevel.DEBUG,LogLevel.LOG,LogLevel.WARN];function generateLogAPI(logLevels){return logLevels.reduce((function(obj,logLevel){var _a;return Object.assign(obj,(_a={},_a[logLevel]=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var cardProxyObj=logManagerStore.get(this).cardProxyObj;var time=new Date;if(!checkFreq(time,cardProxyObj)){nativeConsole.warn("Too much info logged in one minute");return}if(!checkSize(JSON.stringify(args))){nativeConsole.warn("Please do not log information more than 100 KB in one time");return}var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;nativeConsole.log("saveLog Invoke");BDLynxModule.invoke("saveLog",{level:logLevel,message:args,time:time.getTime()},(function(){}))},_a))}),{})}var LogManager=function(){function LogManager(_a){var _b=_a.level,level=_b===void 0?0:_b,cardProxyObj=_a.cardProxyObj;logManagerStore.set(this,{cardProxyObj:cardProxyObj});if(level){var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;BDLynxModule.invoke("enableEngineLog",{},(function(){}))}}return LogManager}();Object.assign(LogManager.prototype,generateLogAPI(logLevels));function getLogManager$1(cardProxyObj,params){if(typeof cardProxyObj.prevKey===undefined){cardProxyObj.prevKey=0;cardProxyObj.cnt=0}if(!cardProxyObj._logManager){cardProxyObj._logManager=new LogManager(__assign(__assign({},params),{cardProxyObj:cardProxyObj}))}return cardProxyObj._logManager}function unwrapExports(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x["default"]:x}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}function getCjsExportFromNamespace(n){return n&&n["default"]||n}var reg=/[\'\"]/;var unquote=function unquote(str){if(!str){return""}if(reg.test(str.charAt(0))){str=str.substr(1)}if(reg.test(str.charAt(str.length-1))){str=str.substr(0,str.length-1)}return str};var index=["caption","icon","menu","message-box","small-caption","status-bar"];var cssSystemFontKeywords=Object.freeze({__proto__:null,"default":index});var index$1=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"];var cssFontWeightKeywords=Object.freeze({__proto__:null,"default":index$1});var index$2=["normal","italic","oblique"];var cssFontStyleKeywords=Object.freeze({__proto__:null,"default":index$2});var index$3=["normal","condensed","semi-condensed","extra-condensed","ultra-condensed","expanded","semi-expanded","extra-expanded","ultra-expanded"];var cssFontStretchKeywords=Object.freeze({__proto__:null,"default":index$3});var dist=createCommonjsModule((function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function split(value,separators,_a){var _b=(_a===void 0?{}:_a).last,last=_b===void 0?false:_b;if(typeof value!=="string"){throw new TypeError("expected a string")}if(!Array.isArray(separators)){throw new TypeError("expected a string array of separators")}if(typeof last!=="boolean"){throw new TypeError("expected a Boolean value for options.last")}var array=[];var current="";var splitMe=false;var func=0;var quote=false;var escape=false;for(var _i=0,value_1=value;_i<value_1.length;_i++){var char=value_1[_i];if(quote){if(escape){escape=false}else if(char==="\\"){escape=true}else if(char===quote){quote=false}}else if(char==='"'||char==="'"){quote=char}else if(char==="("){func+=1}else if(char===")"){if(func>0){func-=1}}else if(func===0){if(separators.indexOf(char)!==-1){splitMe=true}}if(splitMe){if(current!==""){array.push(current.trim())}current="";splitMe=false}else{current+=char}}if(last||current!==""){array.push(current.trim())}return array}exports.split=split;function splitBySpaces(value){var spaces=[" ","\n","\t"];return split(value,spaces)}exports.splitBySpaces=splitBySpaces;function splitByCommas(value){var comma=",";return split(value,[comma],{last:true})}exports.splitByCommas=splitByCommas}));unwrapExports(dist);var dist_1=dist.split;var dist_2=dist.splitBySpaces;var dist_3=dist.splitByCommas;var index$4=["xx-small","x-small","small","medium","large","x-large","xx-large","larger","smaller"];var cssFontSizeKeywords=Object.freeze({__proto__:null,"default":index$4});var cssFontSizeKeywords$1=getCjsExportFromNamespace(cssFontSizeKeywords);var helpers=createCommonjsModule((function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function isSize(value){return/^[\d\.]/.test(value)||value.indexOf("/")!==-1||cssFontSizeKeywords$1.indexOf(value)!==-1}exports.isSize=isSize}));unwrapExports(helpers);var helpers_1=helpers.isSize;var systemFontKeywords=getCjsExportFromNamespace(cssSystemFontKeywords);var fontWeightKeywords=getCjsExportFromNamespace(cssFontWeightKeywords);var fontStyleKeywords=getCjsExportFromNamespace(cssFontStyleKeywords);var fontStretchKeywords=getCjsExportFromNamespace(cssFontStretchKeywords);var dist$1=createCommonjsModule((function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var errorPrefix="[parse-css-font]";var firstDeclarations=["style","weight","stretch","variant"];function parseCSSFont(value){if(typeof value!=="string"){throw error("Expected a string.",TypeError)}if(value===""){throw error("Cannot parse an empty string.")}if(systemFontKeywords.indexOf(value)!==-1){return{system:value}}var font={lineHeight:"normal",stretch:"",style:"",variant:"",weight:""};var consumers=[style,weight,stretch,variant];var tokens=dist.splitBySpaces(value);nextToken:for(var token=tokens.shift();!!token;token=tokens.shift()){if(token==="normal"){continue}for(var _i=0,consumers_1=consumers;_i<consumers_1.length;_i++){var consume=consumers_1[_i];if(consume(token)){continue nextToken}}var parts=dist.split(token,["/"]);font.size=parts[0];if(!!parts[1]){font.lineHeight=parseLineHeight(parts[1])}else if(tokens[0]==="/"){tokens.shift();font.lineHeight=parseLineHeight(tokens.shift())}if(!tokens.length){throw error("Missing required font-family.")}font.family=dist.splitByCommas(tokens.join(" ")).map(unquote);for(var _a=0,firstDeclarations_1=firstDeclarations;_a<firstDeclarations_1.length;_a++){var name_1=firstDeclarations_1[_a];font[name_1]=font[name_1]||"normal"}return font}throw error("Missing required font-size.");function style(token){if(fontStyleKeywords.indexOf(token)===-1){return}if(font.style){throw error("Font style already defined.")}return font.style=token}function weight(token){if(fontWeightKeywords.indexOf(token)===-1){return}if(font.weight){throw error("Font weight already defined.")}return font.weight=token}function stretch(token){if(fontStretchKeywords.indexOf(token)===-1){return}if(font.stretch){throw error("Font stretch already defined.")}return font.stretch=token}function variant(token){return!helpers.isSize(token)&&(font.variant=font.variant?[font.variant,token].join(" "):token)}}exports.default=parseCSSFont;function error(message,ErrorType){if(ErrorType===void 0){ErrorType=Error}return new ErrorType(errorPrefix+" "+message)}function parseLineHeight(value){var parsed=parseFloat(value);if(parsed.toString()===value){return parsed}return value}module.exports=Object.assign(exports.default,exports)}));var parseCSSFont=unwrapExports(dist$1);var e_1,_a;var DEFAULT_FONT_SIZE=10;var DEFAULT_FONT_FAMILY="sans-serif";var DEFAULT_FONT_VALUE=DEFAULT_FONT_SIZE+"px "+DEFAULT_FONT_FAMILY;var APIType;(function(APIType){APIType[APIType["PATH"]=2]="PATH";APIType[APIType["ACTION"]=4]="ACTION";APIType[APIType["PROP"]=8]="PROP";APIType[APIType["PASS_PATH"]=16]="PASS_PATH";APIType[APIType["SET_PROP"]=12]="SET_PROP";APIType[APIType["PROP_ACCEPT_OBJECT"]=32]="PROP_ACCEPT_OBJECT"})(APIType||(APIType={}));var WebCanvasAPIConfig={arc:APIType.PATH,arcTo:APIType.PATH,bezierCurveTo:APIType.PATH,closePath:APIType.PATH,lineTo:APIType.PATH,moveTo:APIType.PATH,quadraticCurveTo:APIType.PATH,rect:APIType.PATH,clearRect:APIType.ACTION,fillText:APIType.ACTION,fillRect:APIType.ACTION,restore:APIType.ACTION,rotate:APIType.ACTION,save:APIType.ACTION,scale:APIType.ACTION,strokeText:APIType.ACTION,strokeRect:APIType.ACTION,transform:APIType.ACTION,translate:APIType.ACTION,clip:APIType.ACTION|APIType.PASS_PATH,fill:APIType.ACTION|APIType.PASS_PATH,stroke:APIType.ACTION|APIType.PASS_PATH,setTransform:APIType.ACTION,setLineDash:APIType.ACTION,fillStyle:APIType.PROP|APIType.PROP_ACCEPT_OBJECT,shadowOffsetX:APIType.PROP,shadowOffsetY:APIType.PROP,shadowColor:APIType.PROP,shadowBlur:APIType.PROP,strokeStyle:APIType.PROP|APIType.PROP_ACCEPT_OBJECT,lineWidth:APIType.PROP,lineCap:APIType.PROP,lineJoin:APIType.PROP,miterLimit:APIType.PROP,lineDashOffset:APIType.PROP,globalAlpha:APIType.PROP,globalCompositeOperation:APIType.PROP,textAlign:APIType.PROP,textBaseline:APIType.PROP,setLineCap:APIType.SET_PROP,setLineJoin:APIType.SET_PROP,setLineWidth:APIType.SET_PROP,setMiterLimit:APIType.SET_PROP,setTextAlign:APIType.SET_PROP,setTextBaseline:APIType.SET_PROP,setGlobalAlpha:APIType.SET_PROP,setFillStyle:APIType.SET_PROP|APIType.PROP_ACCEPT_OBJECT,setStrokeStyle:APIType.SET_PROP|APIType.PROP_ACCEPT_OBJECT,setShadow:APIType.ACTION};var Gradient=function(){function Gradient(type,data){this.type=type;this.data=data;this.colorStop=[]}Gradient.prototype.addColorStop=function(offset,color){this.colorStop.push([offset,color])};Gradient.prototype.toJSON=function(){return[this.type,this.data,this.colorStop]};return Gradient}();var CanvasContextPattern=function(){function CanvasContextPattern(image,repetition){this.image=image;this.repetition=repetition}CanvasContextPattern.prototype.toJSON=function(){return["pattern",this.image,this.repetition]};return CanvasContextPattern}();var contextSymbol=Symbol("context");var canvasSymbol=Symbol("canvas");var BlockCanvasContext=function(){function BlockCanvasContext(canvasId,realContext,realCanvas){this.canvasId=canvasId;this._queue=[];this._path=[];this._font={value:DEFAULT_FONT_VALUE,fontSize:DEFAULT_FONT_SIZE,fontFamily:[DEFAULT_FONT_FAMILY]};this[contextSymbol]=realContext;this[canvasSymbol]=realCanvas}Object.defineProperty(BlockCanvasContext.prototype,"font",{get:function(){return this._font.value},set:function(newFontValue){try{var font=parseCSSFont(newFontValue);if("size"in font&&"family"in font&&font.size&&font.family){var size=font.size,family=font.family;if(!family.includes(DEFAULT_FONT_FAMILY)){family.push(DEFAULT_FONT_FAMILY)}var realSize=size.endsWith("px")?parseInt(size.slice(0,-2),10):NaN;if(!Number.isNaN(realSize)){this._font={value:newFontValue,fontSize:realSize,fontFamily:family}}}this._queue.push({type:"setProperty",params:["font",newFontValue]})}catch(e){nativeConsole.warn("No support canvas font syntax: "+newFontValue+"("+e.message+")")}},enumerable:false,configurable:true});BlockCanvasContext.prototype.beginPath=function(){this._path=[];this._queue.push({type:"beginPath",params:[]})};BlockCanvasContext.prototype.drawImage=function(image){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}var argsLen=args.length;if(argsLen!==2&&argsLen!==4&&argsLen!==8){throw new TypeError("Failed to execute 'drawImage' on 'CanvasContext': 3 or 5 or 9 arguments required.")}this._queue.push({type:"drawImage",params:__spread([image],args)})};BlockCanvasContext.prototype.setFontSize=function(fontSize){fontSize=Number(fontSize);if(Number.isNaN(fontSize)){return}fontSize=Math.max(fontSize,0);var value=this._font.value;this._font.fontSize=fontSize;this._font.value=value.replace(/\d+\.?\d*(?=px)/,""+fontSize);this._queue.push({type:"setProperty",params:["font",this._font.value]})};BlockCanvasContext.prototype.createLinearGradient=function(x0,y0,x1,y1){var data=[x0,y0,x1,y1];var color=new Gradient("linear",data);return color};BlockCanvasContext.prototype.createCircularGradient=function(x,y,r){return new Gradient("radial",[x,y,0,x,y,r])};BlockCanvasContext.prototype.createPattern=function(image,repetition){return new CanvasContextPattern(image,repetition)};BlockCanvasContext.prototype.measureText=function(text){if(text===null||text===undefined){text=""+text}else{text=text.toString()}return this[contextSymbol].measureText(text)};return BlockCanvasContext}();function getWebCanvasPropertyDescriptor(name,config){var desc={enumerable:false,configurable:true};if((config&APIType.SET_PROP)===APIType.ACTION){if(config&APIType.PASS_PATH){desc.value=function(){this._queue.push({type:name,params:__spread(this._path)})}}else{desc.value=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this._queue.push({type:name,params:params})}}}else if((config&APIType.PROP)===APIType.PROP){var isSetter=(config&APIType.ACTION)===APIType.ACTION;var isAcceptObject=(config&APIType.PROP_ACCEPT_OBJECT)===APIType.PROP_ACCEPT_OBJECT;var check_1=isAcceptObject?function(value){return typeof value!=="string"&&typeof value!=="number"&&!(value instanceof Gradient)&&!(value instanceof CanvasContextPattern)}:function(value){return typeof value!=="string"&&typeof value!=="number"};var checkMsg_1=isAcceptObject?"string, number, Gradient or Pattern":"string or number";var specName_1=isSetter?""+name.charAt(3).toLowerCase()+name.slice(4):name;var fn=function(value){if(check_1(value)){nativeConsole.warn("Canvas:",name+" can only accept "+checkMsg_1+", other value will be ignored. Current type is "+typeof value+".");return}this._queue.push({type:"setProperty",params:[specName_1,value]})};if(isSetter){desc.value=fn}else{desc.set=fn;desc.get=function(){return undefined}}}else if((config&APIType.PATH)===APIType.PATH){desc.value=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this._path.push({type:name,params:params})}}if(desc.value){desc.writable=false}else if(!desc.set){return null}return desc}try{for(var _b=__values(Object.entries(WebCanvasAPIConfig)),_c=_b.next();!_c.done;_c=_b.next()){var _d=__read(_c.value,2),name=_d[0],config=_d[1];var desc=getWebCanvasPropertyDescriptor(name,config);if(desc){Object.defineProperty(BlockCanvasContext.prototype,name,desc)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(_c&&!_c.done&&(_a=_b.return))_a.call(_b)}finally{if(e_1)throw e_1.error}}function lowerCase(str){return str.charAt(0).toLowerCase()+str.substr(1)}function tryToRestoreStructureObject(value,ctx,cardProxyObj){var e_1,_a,e_2,_b;if(typeof value.toJSON==="function"){value=value.toJSON()}if(typeof value==="object"&&Array.isArray(value)){switch(value[0]){case"pattern":{return ctx.createPattern(cardProxyObj._images[value[1]],value[2])}case"linear":{var linear=ctx.createLinearGradient.apply(ctx,__spread(value[1]));try{for(var _c=__values(value[2]||[]),_d=_c.next();!_d.done;_d=_c.next()){var stops=_d.value;linear.addColorStop.apply(linear,__spread(stops))}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(_d&&!_d.done&&(_a=_c.return))_a.call(_c)}finally{if(e_1)throw e_1.error}}return linear}case"radial":{var radial=ctx.createRadialGradient.apply(ctx,__spread(value[1]));try{for(var _e=__values(value[2]||[]),_f=_e.next();!_f.done;_f=_e.next()){var stops=_f.value;radial.addColorStop.apply(radial,__spread(stops))}}catch(e_2_1){e_2={error:e_2_1}}finally{try{if(_f&&!_f.done&&(_b=_e.return))_b.call(_e)}finally{if(e_2)throw e_2.error}}return radial}case"rgb":case"rgba":case"hsl":return value[0]+"("+value.slice(1).join(",")+")"}}return value}function getImagePath(type,params){if(type==="drawImage"){return params[0]}if(type==="setProperty"){var _a=__read(params,2),_=_a[0],propertyValue=_a[1];if(typeof(propertyValue===null||propertyValue===void 0?void 0:propertyValue.toJSON)==="function"){var convertValue=propertyValue.toJSON();if(Array.isArray(convertValue)&&convertValue[0]==="pattern"){return convertValue[1]}}}}function action(context,reserve,callback,_queue,cardProxyObj){return __awaiter(this,void 0,void 0,(function(){var drawQueue;return __generator(this,(function(_a){switch(_a.label){case 0:context[contextSymbol].setTransform(SystemInfo.pixelRatio,0,0,SystemInfo.pixelRatio,0,0);if(reserve===false){context[contextSymbol].fillStyle="#000000";context[contextSymbol].strokeStyle="#000000";context[contextSymbol].shadowColor="#000000";context[contextSymbol].shadowBlur=0;context[contextSymbol].shadowOffsetX=0;context[contextSymbol].shadowOffsetY=0;context[contextSymbol].globalAlpha=1;context[contextSymbol].closePath();context[contextSymbol].clearRect(0,0,context[canvasSymbol].width,context[canvasSymbol].height)}drawQueue=_queue.filter((function(_a){var _b;var type=_a.type,params=_a.params;var imgPath=getImagePath(type,params);return imgPath&&!((_b=cardProxyObj._images[imgPath])===null||_b===void 0?void 0:_b.ready)})).map((function(_a){var type=_a.type,params=_a.params;var imgPath=getImagePath(type,params);return new Promise((function(resolve){cardProxyObj._images[imgPath]=cardProxyObj.lynx.createImage(imgPath);cardProxyObj._images[imgPath].onload=function(){cardProxyObj._images[imgPath].ready=true;resolve()};cardProxyObj._images[imgPath].onerror=function(e){nativeConsole.error("Failed to load image "+imgPath+" \n ErrMsg: "+JSON.stringify(e));resolve()}}))}));return[4,Promise.all(drawQueue)];case 1:_a.sent();_queue.map((function(_a){var _b;var _c,_d;var type=_a.type,params=_a.params;if(type==="setProperty"){var _e=__read(params,2),propertyName=_e[0],propertyValue=_e[1];context[contextSymbol][propertyName]=tryToRestoreStructureObject(propertyValue,context[contextSymbol],cardProxyObj);return}if(type.indexOf("set")===0&&type!=="setTransform"){var setterName=lowerCase(type.substr(3));if(setterName==="shadow"){["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"].forEach((function(method,i){context[contextSymbol][method]=params[i]}))}else{if(setterName==="font"){context[contextSymbol].font=params[0]}else if(setterName==="lineDash"){context[contextSymbol].setLineDash(params[0]);context[contextSymbol].lineDashOffset=params[1]||0}else if(setterName==="textBaseline"){if(params[0]==="normal"){params[0]="alphabetic"}context[contextSymbol].textBaseline=params[0]}else{context[contextSymbol][setterName]=params[0]}}}if(type==="drawImage"){var _f=__read(params),imgPath=_f[0],posParamArray=_f.slice(1);(_b=context[contextSymbol])[type].apply(_b,__spread([cardProxyObj._images[imgPath]],posParamArray));return}if(type==="fill"||type==="stroke"){context[contextSymbol].beginPath();var instructions=params;instructions.forEach((function(_a){var _b;var type=_a.type,params=_a.params;(_b=context[contextSymbol])[type].apply(_b,__spread(params))}));context[contextSymbol][type]();return}if(type==="clip"){var instructions=params;instructions.forEach((function(_a){var _b;var type=_a.type,params=_a.params;(_b=context[contextSymbol])[type].apply(_b,__spread(params))}));context[contextSymbol][type]();return}(_d=(_c=context[contextSymbol])[type])===null||_d===void 0?void 0:_d.call.apply(_d,__spread([_c],params))}));callback();return[2]}}))}))}function getContext(cardProxyObj,canvasId){if(!cardProxyObj.canvasManager){cardProxyObj.canvasManager=new Map;cardProxyObj._images={}}if(!cardProxyObj.canvasManager.has(canvasId)){var canvas_1=cardProxyObj.lynx.createCanvas(canvasId);var context_1=canvas_1.getContext("2d");cardProxyObj.canvasManager.set(canvasId,{canvas:canvas_1,context:context_1})}var _a=cardProxyObj.canvasManager.get(canvasId),canvas=_a.canvas,context=_a.context;var blockCanvasContext=new BlockCanvasContext(canvasId,context,canvas);blockCanvasContext.draw=function(reserve,callback){if(reserve===void 0){reserve=false}if(callback===void 0){callback=function(){}}if(cardProxyObj._onFirstReady){action(this,reserve,callback,this._queue,cardProxyObj)}else{if(!Array.isArray(cardProxyObj._canvasQueue)){cardProxyObj._canvasQueue=[]}cardProxyObj._canvasQueue.push({action:action,context:this,reserve:reserve,queue:this._queue,callback:callback,cardProxyObj:cardProxyObj});this._queue=[]}};return blockCanvasContext}function createCanvasContext$1(cardProxyObj,params,cb){var _a;var canvasId=(_a=params[0])!==null&&_a!==void 0?_a:"";return getContext(cardProxyObj,canvasId)}function canvasGetImageData$1(cardProxyObj,params,cb){if(params===void 0){params=[{}]}var _a=params[0],canvasId=_a.canvasId,x=_a.x,y=_a.y,width=_a.width,height=_a.height;var context=getContext(cardProxyObj,canvasId);Promise.resolve().then((function(){var _a,_b,_c,_d,_e,_f,_g,_h;var res;try{res=context[contextSymbol].getImageData(x,y,width,height)}catch(err){(_b=(_a=params[0])===null||_a===void 0?void 0:_a.fail)===null||_b===void 0?void 0:_b.call(_a,{errMsg:err});(_d=(_c=params[0])===null||_c===void 0?void 0:_c.complete)===null||_d===void 0?void 0:_d.call(_c,{errMsg:err});return}(_f=(_e=params[0])===null||_e===void 0?void 0:_e.success)===null||_f===void 0?void 0:_f.call(_e,res);(_h=(_g=params[0])===null||_g===void 0?void 0:_g.complete)===null||_h===void 0?void 0:_h.call(_g,res)}))}function canvasPutImageData$1(cardProxyObj,params,cb){if(params===void 0){params=[{}]}var _a=params[0],canvasId=_a.canvasId,data=_a.data,x=_a.x,y=_a.y,width=_a.width,height=_a.height;var context=getContext(cardProxyObj,canvasId);Promise.resolve().then((function(){var _a,_b,_c,_d,_e,_f,_g,_h;var res;try{var imageData=context[contextSymbol].createImageData(width,height);imageData.data=data;res=context[contextSymbol].putImageData(imageData,x,y)}catch(err){(_b=(_a=params[0])===null||_a===void 0?void 0:_a.fail)===null||_b===void 0?void 0:_b.call(_a,{errMsg:err});(_d=(_c=params[0])===null||_c===void 0?void 0:_c.complete)===null||_d===void 0?void 0:_d.call(_c,{errMsg:err});return}(_f=(_e=params[0])===null||_e===void 0?void 0:_e.success)===null||_f===void 0?void 0:_f.call(_e,{errMsg:"putImageData:ok"});(_h=(_g=params[0])===null||_g===void 0?void 0:_g.complete)===null||_h===void 0?void 0:_h.call(_g,{errMsg:"putImageData:ok"})}))}var apiFuncs=Object.freeze({__proto__:null,setBlockInfo:setBlockInfo$1,cancel:cancel$1,saveState:saveState$1,getHostInfo:getHostInfo$1,getUserInfo:getUserInfo$1,onViewResize:onViewResize$1,offViewResize:offViewResize$1,hideBlockLoading:hideBlockLoading$1,onThemeChange:onThemeChange$1,offThemeChange:offThemeChange$1,canIUse:canIUse$1,getLogManager:getLogManager$1,createCanvasContext:createCanvasContext$1,canvasGetImageData:canvasGetImageData$1,canvasPutImageData:canvasPutImageData$1});var EventEmitter=function(){function EventEmitter(){this._events=new Map;this._all=[]}EventEmitter.prototype.addListener=function(eventName,listener,context){var event=this._events.get(eventName);if(event){event.push({listener:listener,context:context})}else{this._events.set(eventName,[{listener:listener,context:context}])}};EventEmitter.prototype.removeListener=function(eventName,listener){var e_1,_a;if(typeof listener!=="function"){throw new Error("removeListener only takes instances of Function")}var events=this._events.get(eventName);var flag=false;var index=0;if(Array.isArray(events)){try{for(var events_1=__values(events),events_1_1=events_1.next();!events_1_1.done;events_1_1=events_1.next()){var item=events_1_1.value;if(listener===item.listener){flag=true;break}index++}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(events_1_1&&!events_1_1.done&&(_a=events_1.return))_a.call(events_1)}finally{if(e_1)throw e_1.error}}flag&&events.splice(index,1)}};EventEmitter.prototype.emit=function(eventName,data){var e_2,_a;var events=this._events.get(eventName);if(Array.isArray(events)){try{for(var events_2=__values(events),events_2_1=events_2.next();!events_2_1.done;events_2_1=events_2.next()){var item=events_2_1.value;var listener=item.listener,context=item.context;if(typeof listener==="function"){listener.apply(context||this,Array.isArray(data)?data:[data])}}}catch(e_2_1){e_2={error:e_2_1}}finally{try{if(events_2_1&&!events_2_1.done&&(_a=events_2.return))_a.call(events_2)}finally{if(e_2)throw e_2.error}}}else{nativeConsole.warn("emit event "+eventName+" is not register.")}this._all.forEach((function(func){func.call(this,eventName,data)}))};EventEmitter.prototype.removeAllListerners=function(eventName){this._events.delete(eventName)};EventEmitter.prototype.removeAllListeners=function(eventName){this._events.delete(eventName)};EventEmitter.prototype.trigger=function(eventName,params){var e_3,_a;var events=this._events.get(eventName);if(Array.isArray(events)){if(typeof params==="string"){params=JSON.parse(params)}try{for(var events_3=__values(events),events_3_1=events_3.next();!events_3_1.done;events_3_1=events_3.next()){var item=events_3_1.value;var listener=item.listener,context=item.context;if(typeof listener==="function"){listener.call(context||this,params)}}}catch(e_3_1){e_3={error:e_3_1}}finally{try{if(events_3_1&&!events_3_1.done&&(_a=events_3.return))_a.call(events_3)}finally{if(e_3)throw e_3.error}}}else{nativeConsole.warn("trigger event "+eventName+" is not register.")}};EventEmitter.prototype.toggle=function(eventName){var data=[];for(var _i=1;_i<arguments.length;_i++){data[_i-1]=arguments[_i]}this.emit(eventName,data)};EventEmitter.prototype.onAny=function(fn){if(typeof fn!=="function"){throw new Error("onAny only accepts instances of Function")}this._all.push(fn)};EventEmitter.prototype.listenerCount=function(eventName){var event=this._events.get(eventName);return Array.isArray(event)?event.length:0};return EventEmitter}();function registerBlockitNativeEvent(BDLynxAPIModule,cardProxyObj){var _a;cardProxyObj.emitter=(_a=cardProxyObj.emitter)!==null&&_a!==void 0?_a:new EventEmitter;registerThemeChangeEvent(BDLynxAPIModule,cardProxyObj)}var API_TYPE;(function(API_TYPE){API_TYPE["INVOKE"]="invoke";API_TYPE["ON"]="on"})(API_TYPE||(API_TYPE={}));function generateSyncFunction(apiName,apiList,cardProxyObj,BDLynxAPIModule){}function generateInvokeFunction(apiName,apiList,cardProxyObj){apiName=apiName.trim();apiList[apiName]=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}nativeConsole.log("call apiName: ",apiName);var BDLynxModule=cardProxyObj.NativeModules.BDLynxModule;BDLynxModule.invoke(apiName,params[0],(function(res){afterApiCall(apiName,res,params[0],cardProxyObj._appInstance)}))}}function generateOnFunction(apiName,apiList,BDLynxAPIModule,cardProxyObj){apiName=apiName.trim();if(!apiName.startsWith("on")){nativeConsole.warn("host apiName "+apiName+" is not started with on!")}var realApiName=apiName.replace(/^on/,"");apiList[apiName]=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}if(cardProxyObj.emitter.listenerCount(apiName)===0){nativeConsole.log("register api: ",apiName);BDLynxAPIModule.addListener(apiName,(function(res){nativeConsole.log("trigger api: ",apiName);cardProxyObj.emitter.trigger(apiName,res)}))}nativeConsole.log("addListener api: ",apiName);cardProxyObj.emitter.addListener(apiName,params[0])};var offApiName="off"+realApiName;apiList[offApiName]=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}nativeConsole.log("off api: ",apiName);cardProxyObj.emitter.removeListener(apiName,params[0])}}function hostApiRegister(customApis,apiList,cardProxyObj,BDLynxAPIModule){var e_1,_a;try{for(var customApis_1=__values(customApis),customApis_1_1=customApis_1.next();!customApis_1_1.done;customApis_1_1=customApis_1.next()){var API=customApis_1_1.value;var apiName=API.apiName,_b=API.isSync,isSync=_b===void 0?false:_b,_c=API.apiType,apiType=_c===void 0?API_TYPE.INVOKE:_c;nativeConsole.log("apiName: ",apiName," isSync: ",isSync," apiType: ",apiType);if(isSync){generateSyncFunction(apiName,apiList,cardProxyObj,BDLynxAPIModule)}else if(apiType===API_TYPE.INVOKE){generateInvokeFunction(apiName,apiList,cardProxyObj)}else if(apiType===API_TYPE.ON){generateOnFunction(apiName,apiList,BDLynxAPIModule,cardProxyObj)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(customApis_1_1&&!customApis_1_1.done&&(_a=customApis_1.return))_a.call(customApis_1)}finally{if(e_1)throw e_1.error}}}var defaultApiInit=_global.BDLynxSDKCore.apiInit;var defaultRegisterNativeEvent=_global.BDLynxSDKCore.registerNativeEvent;var cardProxyObj,BDLynxAPIModule;var DO_NOT_CHECK_LIST=["onViewResize","offViewResize","onThemeChange","offThemeChange"];var getApiList=function(apiListEnum,apiSyncListEnum,apiAsyncListEnum,apiList,cardProxyObj){apiListEnum.forEach((function(apiName){apiList[apiName]=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}var apiFun=apiFuncs[apiName];if(typeof apiFun!=="function"){throw new Error(apiName+" is not support.")}nativeConsole.log("call beforeApiCall apiName:",apiName);if(DO_NOT_CHECK_LIST.includes(apiName)){return apiFun(cardProxyObj,params,(function(){}))}var checkRes=beforeApiCall(apiParams[apiName],params);if(checkRes.status!==0){var res={errMsg:apiName+":fail "+checkRes.message};if(apiAsyncListEnum.includes(apiName)){return afterApiCall(apiName,res,params[0],cardProxyObj._appInstance)}return res}if(apiSyncListEnum.includes(apiName)){var apiRes=apiFun(cardProxyObj,params);return apiRes}return apiFun(cardProxyObj,params,(function(res){afterApiCall(apiName,res,params[0],cardProxyObj._appInstance)}))}}))};_global.BDLynxSDKCore.apiInit=function(){var apiList=typeof defaultApiInit==="function"?defaultApiInit.call(this):{};cardProxyObj=this;getApiList(apiListEnum,apiSyncListEnum,apiAsyncListEnum,apiList,cardProxyObj);return apiList};_global.BDLynxSDKCore.registerNativeEvent=function(_BDLynxAPIModule){BDLynxAPIModule=_BDLynxAPIModule;if(typeof defaultRegisterNativeEvent==="function"){defaultRegisterNativeEvent(BDLynxAPIModule)}};var safeCall=function(fn,context){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var result=fn.apply(context,args);return result}};function onFirstLoadPerfReady(){if(cardProxyObj._onFirstReady){return}cardProxyObj._onFirstReady=true;if(!Array.isArray(cardProxyObj._canvasQueue)){return}cardProxyObj._canvasQueue.map((function(_a){var action=_a.action,context=_a.context,reserve=_a.reserve,queue=_a.queue,callback=_a.callback;return action(context,reserve,callback,queue)}));cardProxyObj._canvasQueue=[]}_global.___blockBuilder=function(require,module,exports,Card,setTimeout,setInterval,clearInterval,clearTimeout,NativeModules,tt,console,Component,TaroLynx,nativeAppId,Behavior,LynxJSBI,lynx,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,fetch,XMLHttpRequest,WebSocket,webkit,Reporter,print,Function,global){var LifeCycle=["onLoad","onDestroy","onResourceChange","onActivate","onInactivate","onTypedMessage"];var noop=function(){};getApiList(blockApiListEnum,blockApiSyncListEnum,blockApiAsyncListEnum,tt,cardProxyObj);return function(params){var e_1,_a;_global.__blockType="block";var methods=params.methods;try{for(var LifeCycle_1=__values(LifeCycle),LifeCycle_1_1=LifeCycle_1.next();!LifeCycle_1_1.done;LifeCycle_1_1=LifeCycle_1.next()){var lifeName=LifeCycle_1_1.value;params[lifeName]=typeof params[lifeName]==="function"?params[lifeName]:noop}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(LifeCycle_1_1&&!LifeCycle_1_1.done&&(_a=LifeCycle_1.return))_a.call(LifeCycle_1)}finally{if(e_1)throw e_1.error}}var onLoadFunc=params.onLoad;params.onLoad=function(){var _this=this;registerBlockitNativeEvent(BDLynxAPIModule,cardProxyObj);registerViewResizeEvent.call(this,cardProxyObj);BDLynxAPIModule.addListener("onActivate",params.onActivate.bind(this));BDLynxAPIModule.addListener("onInactivate",params.onInactivate.bind(this));BDLynxAPIModule.addListener("onResourceChange",params.onResourceChange.bind(this));BDLynxAPIModule.addListener("onTypedMessage",params.onTypedMessage.bind(this));this.getJSModule("GlobalEventEmitter").addListener("onFirstLoadPerfReady",onFirstLoadPerfReady,this);var options={};if(typeof this.data.block_init_data==="object"){var _a=this.data.block_init_data,host=_a.host,blockInfo=_a.blockInfo,blockInstanceInfo=_a.blockInstanceInfo,typedDataCollection=_a.typedDataCollection,_b=_a.customApis,customApis=_b===void 0?[]:_b;options.host=host;options.blockInfo=blockInfo;options.blockInstanceInfo=blockInstanceInfo;options.typedDataCollection=typedDataCollection;if(Array.isArray(customApis)){hostApiRegister(customApis,tt,cardProxyObj,BDLynxAPIModule)}delete this.data.block_init_data}if(isObject(this.methods)){Object.entries(this.methods).forEach((function(_a){var _b=__read(_a,2),key=_b[0],fn=_b[1];_this.methods[key]=safeCall(fn,_this);Object.keys(fn).forEach((function(prop){nativeConsole.warn("It's not recommended to add prop:'"+prop+"' on method's function["+key+"].");if(typeof fn[prop]==="function"){_this.methods[key][prop]=fn[prop].bind(fn)}else{_this.methods[key][prop]=fn[prop]}}))}))}onLoadFunc.call(this,options)};for(var methodName in methods){params[methodName]=methods[methodName]}Card(params)}};_global.___creatorBuilder=function(require,module,exports,Card,setTimeout,setInterval,clearInterval,clearTimeout,NativeModules,tt,console,Component,TaroLynx,nativeAppId,Behavior,LynxJSBI,lynx,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,fetch,XMLHttpRequest,WebSocket,webkit,Reporter,print,Function,global){var LifeCycle=["onLoad","onDestroy","onTypedMessage"];var noop=function(){};getApiList(creatorApiListEnum,creatorApiSyncListEnum,creatorApiAsyncListEnum,tt,cardProxyObj);return function(params){var e_2,_a;_global.__blockType="creator";var methods=params.methods;try{for(var LifeCycle_2=__values(LifeCycle),LifeCycle_2_1=LifeCycle_2.next();!LifeCycle_2_1.done;LifeCycle_2_1=LifeCycle_2.next()){var lifeName=LifeCycle_2_1.value;params[lifeName]=params[lifeName]||noop}}catch(e_2_1){e_2={error:e_2_1}}finally{try{if(LifeCycle_2_1&&!LifeCycle_2_1.done&&(_a=LifeCycle_2.return))_a.call(LifeCycle_2)}finally{if(e_2)throw e_2.error}}var onLoadFunc=params.onLoad;params.onLoad=function(){var _this=this;registerBlockitNativeEvent(BDLynxAPIModule,cardProxyObj);registerViewResizeEvent.call(this,cardProxyObj);BDLynxAPIModule.addListener("onTypedMessage",params.onTypedMessage.bind(this));this.getJSModule("GlobalEventEmitter").addListener("onFirstLoadPerfReady",onFirstLoadPerfReady,this);var options={};if(typeof this.data.block_init_data==="object"){var _a=this.data.block_init_data,host=_a.host,blockInfo=_a.blockInfo,typedDataCollection=_a.typedDataCollection,_b=_a.customApis,customApis=_b===void 0?[]:_b;options.host=host;options.blockInfo=blockInfo;options.typedDataCollection=typedDataCollection;if(Array.isArray(customApis)){hostApiRegister(customApis,tt,cardProxyObj,BDLynxAPIModule)}delete this.data.block_init_data}if(isObject(this.methods)){Object.entries(this.methods).forEach((function(_a){var _b=__read(_a,2),key=_b[0],fn=_b[1];_this.methods[key]=safeCall(fn,_this);Object.keys(fn).forEach((function(prop){nativeConsole.warn("It's not recommended to add prop:'"+prop+"' on method's function["+key+"].");if(typeof fn[prop]==="function"){_this.methods[key][prop]=fn[prop].bind(fn)}else{_this.methods[key][prop]=fn[prop]}}))}))}onLoadFunc.call(this,options)};for(var methodName in methods){params[methodName]=methods[methodName]}Card(params)}}})();
//# sourceMappingURL=blockit_core.js.map
